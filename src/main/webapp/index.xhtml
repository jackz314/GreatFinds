<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--suppressed because intellij is wrong :)-->
<!--suppress ELSpecValidationInJSP -->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <h:outputStylesheet name="css/styles.css"/>
</h:head>

<f:view>
<!--    <h:outputLabel value="Hello, world"/>-->
    <h1>GreatFinds</h1>
    <h3>#{entryBean.randNum}</h3>
    <h3>JSF Version: #{entryBean.JSFVersion}</h3>
    <a href="entries.xhtml">Datatable test</a>
    <a href="jsp_test.jsp">JSP test</a>
    <p id="test">
        Hello, this is the test of the css stuff. This text should be blue!
    </p>
    <br/>
</f:view>

<h:form>
    <h:inputText value="#{entryBean.inputEntry.msg}"/>
    <h:commandButton value="Submit Entry" ajax="true" action="#{entryBean.submit}">
        <f:ajax execute="@form" render="@form entries"/>
    </h:commandButton>
</h:form>

<!-- User Authentication Form(s) -->
<h4>Registration</h4>
<h:form>
    <p> Username: <h:inputText id="usernameInput" value="#{userBean.inputUser.displayName}" required="true" requiredMessage="Please enter a username. "/>
        Email: <h:inputText id="emailInput" value="#{userBean.inputUser.email}" required="true" requiredMessage="Please enter a valid email. "/>
        Password: <h:inputSecret id="pwdInput" value="#{userBean.inputUser.pwd}" required="true" requiredMessage="Please enter a password. "/></p>
    <h:message for="usernameInput" style="color: red"/>
    <h:message for="emailInput" style="color: red"/>
    <h:message for="pwdInput" style="color: red"/>
    <h:commandButton value="Register" ajax="true" action="#{userBean.submit}">
        <f:ajax execute="@form" render="@form users"/>
    </h:commandButton>

</h:form>

<br/>

<h4>Create Post</h4>
<h:form>
    <h:inputText id="postInput" value="#{mainBean.inputPost.caption}" required="true" requiredMessage="Please enter a caption"/>
    <h:commandButton value="Submit Post" ajax="true" action="#{mainBean.submitPost}">
        <f:ajax execute="@form" render="@form feed"/>
    </h:commandButton>
    <h:message for="postInput" style="color: red"/>
</h:form>

<br/>

<h2>Entries</h2>
<h:dataTable id="entries" value="#{entryBean.entries}" var="entry">
    <h:column>#{entry.msg}</h:column>
</h:dataTable>

<br/>

<h2>User Table</h2>
<h:dataTable id="users" value="#{userBean.users}" var="user">
    <h:column>#{user.displayName}</h:column>
</h:dataTable>

<h2>Content Feed</h2>
<h:dataTable id="feed" value="#{mainBean.posts}" var="post">
    <h:column><f:facet name = "header">Caption</f:facet>
        #{post.caption}</h:column>
    <h:column><f:facet name = "header">Time</f:facet>
        #{post.timestamp}</h:column>
    <h:column><f:facet name = "header">G-Score</f:facet>
        #{post.rating}</h:column>
    <h:column><f:facet name = "header">Likes</f:facet>
        #{post.numLikes}</h:column>
</h:dataTable>

<!--doesn't work for now, suspected bug in JSF?-->
<!--listen to websocket for changes and update entries when changed-->
<!--<h:form>-->
<!--    <f:websocket channel="pushCh" scope="view" onmessage="function(m){console.log(m);}">-->
<!--        <f:ajax event="updateEntries" render="entries" />-->
<!--    </f:websocket>-->
<!--</h:form>-->
</html>
