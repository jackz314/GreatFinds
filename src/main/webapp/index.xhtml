<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--suppressed because intellij is wrong :)-->
<!--suppress ELSpecValidationInJSP -->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:o="http://omnifaces.org/ui"
>

<h:head>
    <h:outputStylesheet name="css/styles.css"/>
</h:head>

<f:view>
    <!--    <h:outputLabel value="Hello, world"/>-->
    <h1>GreatFinds</h1>
    <h3>#{entryBean.randNum}</h3>
    <h3>JSF Version: #{entryBean.JSFVersion}</h3>
    <a href="entries.xhtml">Datatable test</a>
    <a href="jsp_test.jsp">JSP test</a>
    <p id="test">
        Hello, this is the test of the css stuff. This text should be blue!
    </p>
    <br/>
</f:view>

<h:form>
    <h:inputText value="#{entryBean.inputEntry.msg}"/>
    <h:commandButton value="Submit Entry" ajax="true" action="#{entryBean.submit}">
        <f:ajax execute="@form" render="@form entries"/>
    </h:commandButton>
</h:form>

<p>Login status: #{userBean.loginStatus}</p>

<!-- User Authentication Form(s) -->
<h:panelGroup rendered="#{not userBean.userLoggedIn}">
    <h4>Registration</h4>
    <h:form binding="#{registerForm}">
        <p> Username: <h:inputText id="usernameInput" value="#{userBean.registerUser.displayName}" required="true"
                                   requiredMessage="Please enter a username."/>
            Email: <h:inputText id="emailInput" value="#{userBean.registerUser.email}" required="true"
                                requiredMessage="Please enter a valid email."
                                validator="#{userBean.validateRegisterEmail}"/>
            Password: <h:inputSecret id="pwdInput" value="#{userBean.registerUser.pwd}" required="true"
                                     requiredMessage="Please enter a password."/>
        </p>
        <h:messages rendered="#{registerForm.submitted}" infoClass="errorMsg" errorClass="errorMsg" id="reg_msgs"/>
        <h:commandButton value="Register" ajax="true" action="#{userBean.register}">
            <f:ajax execute="@form" render="@form users"/>
        </h:commandButton>
    </h:form>

    <h4>Login</h4>
    <h:form binding="#{loginForm}">
        <p> Email: <h:inputText id="emailLogin" value="#{userBean.loginUser.email}" required="true"
                                requiredMessage="Please enter a valid email. "
                                validator="#{userBean.validateLoginEmail}"/>
            Password: <h:inputSecret id="pwdLogin" value="#{userBean.loginUser.pwd}"
                                     required="true" requiredMessage="Please enter a password. "/>
        </p>
        <o:validateMultiple components="emailLogin pwdLogin" validator="#{userBean.validateLogin}"
                            message="Incorrect email or password."/>
        <h:messages rendered="#{loginForm.submitted}" infoClass="errorMsg" errorClass="errorMsg" redisplay="false"
                    id="login_msgs"/>
        <h:commandButton value="Login" ajax="true" action="#{userBean.login}">
            <f:ajax execute="@form" render="@all"/>
        </h:commandButton>
    </h:form>

    <br/>
</h:panelGroup>

<h:panelGroup rendered="#{userBean.userLoggedIn}">
    <h:form>
        Tags:
        <h:inputText id="tagInput" value="#{userBean.tagStr}">
            <f:ajax event="keyup" render="userFeed"/>
        </h:inputText>
        <br/>
        <h:commandButton value="Log out" ajax="true" action="#{userBean.logOut}">
            <f:ajax execute="@form" render="@all"/>
        </h:commandButton>
    </h:form>

    <h4>Create Post</h4>
    <h:form>
        <h5>Add new media title:</h5>
        <p> Title: <h:inputText id="titleInput" value="#{userBean.inputMediaTitle.title}" required="true"
                     requiredMessage="Please enter a mediaTitle"/>
            Genre: <h:inputText id="genreInput" value="#{userBean.inputMediaTitle.genre}" required="true"
                     requiredMessage="Please enter a genre"/>
        </p>
        <p>
            Caption: <h:inputText id="postInput" value="#{userBean.inputPost.caption}" required="true"
                     requiredMessage="Please enter a caption"/>
            Rating: <h:inputText id="ratingInput" value="#{userBean.inputPost.rating}" required="true"
                     requiredMessage="Please enter a rating"/>
        </p>
        <h:commandButton value="Submit Post" ajax="true" action="#{userBean.submitPost}">
            <f:ajax execute="@form" render="@form userFeed globalFeed"/>
        </h:commandButton>
        <h:message for="postInput" style="color: red"/>
        <h:message for="ratingInput" style="color: red"/>
        <h:message for="titleInput" style="color: red"/>
        <h:message for="genreInput" style="color: red"/>
    </h:form>
</h:panelGroup>

<br/>

<h2>Feed</h2>
<h:dataTable id="userFeed" value="#{userBean.posts}" var="post">
    <h:column><f:facet name="header">Caption</f:facet>
        #{post.caption}</h:column>
    <h:column><f:facet name="header">Time</f:facet>
        #{post.timestamp}</h:column>
    <h:column><f:facet name="header">G-Score</f:facet>
        #{post.rating}</h:column>
    <h:column><f:facet name="header">Likes</f:facet>
        #{post.numLikes}</h:column>
</h:dataTable>

<br/>
<h3>--Debugging Info Below--</h3>

<!--<h2>Entries</h2>-->
<!--<h:dataTable id="entries" value="#{entryBean.entries}" var="entry">-->
<!--    <h:column>#{entry.msg}</h:column>-->
<!--</h:dataTable>-->

<h2>User Table</h2>
<h:dataTable id="users" value="#{globalBean.allUsers}" var="user">
    <h:column><f:facet name="header">Name</f:facet>#{user.displayName}</h:column>
    <h:column><f:facet name="header">Email</f:facet>#{user.email}</h:column>
    <h:column><f:facet name="header">Password</f:facet>#{user.pwd}</h:column>
</h:dataTable>

<h2>Global Feed</h2>
<h:dataTable id="globalFeed" value="#{globalBean.allPosts}" var="post">
    <h:column><f:facet name="header">Caption</f:facet>
        #{post.caption}</h:column>
    <h:column><f:facet name="header">Time</f:facet>
        #{post.timestamp}</h:column>
    <h:column><f:facet name="header">G-Score</f:facet>
        #{post.rating}</h:column>
    <h:column><f:facet name="header">Likes</f:facet>
        #{post.numLikes}</h:column>
</h:dataTable>

<!--doesn't work for now, suspected bug in JSF?-->
<!--listen to websocket for changes and update entries when changed-->
<!--<h:form>-->
<!--    <f:websocket channel="pushCh" scope="view" onmessage="function(m){console.log(m);}">-->
<!--        <f:ajax event="updateEntries" render="entries" />-->
<!--    </f:websocket>-->
<!--</h:form>-->
</html>
